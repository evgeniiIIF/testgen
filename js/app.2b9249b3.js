(function(){"use strict";var t={1930:function(t,e,n){var i=n(9242),o=n(3396),s=n(7139);const r={class:"v-app"},a={class:"v-app__dropdown"},l=["disabled"],c={key:0},d={key:1,class:"loading"},u={class:"v-app__table"},p=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"Сущность"),(0,o._)("th",null,"id")])],-1),m=(0,o._)("tr",null,null,-1),h=["disabled"],v=(0,o._)("span",null,"Очистить",-1),f=[v];function g(t,e,n,i,v,g){const _=(0,o.up)("v-dropdown");return(0,o.wg)(),(0,o.iD)("div",r,[(0,o._)("div",a,[(0,o.Wm)(_,{items:v.dropdownItems,onOnSelectedItem:e[0]||(e[0]=t=>g.onSelectedItem(t))},null,8,["items"])]),(0,o._)("button",{class:"v-app__button",disabled:!v.hasSelected,onClick:e[1]||(e[1]=(...t)=>g.createEntity&&g.createEntity(...t))},[t.loading?((0,o.wg)(),(0,o.iD)("span",d)):((0,o.wg)(),(0,o.iD)("span",c,"Создать"))],8,l),(0,o._)("table",u,[p,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.createdEntities,(t=>((0,o.wg)(),(0,o.iD)("tr",{key:t.id},[(0,o._)("td",null,(0,s.zw)(t.name),1),(0,o._)("td",null,(0,s.zw)(t.id),1)])))),128)),m]),(0,o._)("button",{class:"v-app__button",disabled:!t.createdEntities.length,onClick:e[2]||(e[2]=(...t)=>g.clearEntities&&g.clearEntities(...t))},f,8,h)])}const _={class:"v-dropdown__label"},y=(0,o._)("span",{class:"v-dropdown__title"},"title",-1),w=["value"],E=(0,o._)("span",{class:"v-dropdown__arrow"},"⌄",-1),b={class:"v-dropdown__menu menu-dropdown"},O=["onClick"];function I(t,e,n,r,a,l){return(0,o.wg)(),(0,o.iD)("div",{class:(0,s.C_)(["v-dropdown",a.menuIsOpen?"v-dropdown--menu-open":""])},[(0,o._)("label",_,[y,(0,o._)("div",{class:"v-dropdown__field",onClick:e[0]||(e[0]=t=>a.menuIsOpen=!a.menuIsOpen)},[(0,o._)("input",{type:"text",class:"v-dropdown__input",readonly:"",value:a.selected},null,8,w),E])]),(0,o.wy)((0,o._)("ul",b,[((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(n.items,((t,e)=>((0,o.wg)(),(0,o.iD)("li",{class:"menu-dropdown__item",key:e,onClick:e=>l.selectItem(e,t)},(0,s.zw)(t),9,O)))),128))],512),[[i.F8,a.menuIsOpen]])],2)}var k={props:{items:{type:Array,default(){return[]}}},data(){return{menuIsOpen:!1,selected:null}},methods:{selectItem(t,e){this.selected=e;const n=t.target.closest(".v-dropdown").querySelector(".v-dropdown__input");this.menuIsOpen=!1,n.focus(),this.$emit("on-selected-item",{hasSelected:this.hasSelected,selected:this.selected})},hideOptions(t){this.menuIsOpen&&!t.target.closest(".v-dropdown")&&(this.menuIsOpen=!1)}},computed:{hasSelected(){return this.selected!==this.items[0]}},mounted(){this.selected=this.items[0],document.addEventListener("click",this.hideOptions.bind(this),!0)},beforeDestroy(){document.removeEventListener("click",this.hideOptions)}},S=n(89);const C=(0,S.Z)(k,[["render",I]]);var j=C,D=n(65),L={components:{vDropdown:j},data(){return{dropdownItems:["Не выбрано","Сделка","Контакт","Компания"],hasSelected:!1,entity:null}},methods:{...(0,D.nv)(["aCreateEntity","aInit","aClearEntities"]),onSelectedItem(t){this.hasSelected=t.hasSelected,this.entity=t.selected},createEntity(){this.aCreateEntity(this.entity)},clearEntities(){this.aClearEntities()}},computed:{...(0,D.Se)(["loading","createdEntities"])},mounted(){this.aInit()}};const T=(0,S.Z)(L,[["render",g]]);var x=T,z=(n(7658),(0,D.MT)({state:{entities:{"Сделка":"leads","Контакт":"contacts","Компания":"companies"},loading:!1,createdEntities:[],entity_id:null,token:""},getters:{loading(t){return t.loading},entities(t){return t.entities},entity_id(t){return t.entity_id},createdEntities(t){return t.createdEntities},token(t){return t.token}},mutations:{startLoading(t){t.loading=!0},endLoading(t){t.loading=!1},createEntity(t,e){t.createdEntities.push(e)},init(t){let e="http://localhost:8080/oauth/get-token.php";fetch(e,{headers:{"Content-Type":"application/json","X-Client-Id":30878566}}).then((t=>t.json())).then((e=>t.token=e.access_token)).catch((t=>console.log(t)));localStorage.getItem("entities")&&(console.log("init"),t.createdEntities=JSON.parse(localStorage.getItem("entities")))},saveEntity(t){let e=JSON.stringify(t.createdEntities);localStorage.setItem("entities",e)},clearEntities(t){localStorage.getItem("entities")&&(t.createdEntities=[],localStorage.removeItem("entities"))}},actions:{aCreateEntity(t,e){t.commit("startLoading");let n=t.getters.entities[e],i=`/api/v4/${n}`,o=t.getters.token;fetch(i,{method:"POST",body:JSON.stringify([{name:e}]),headers:{"Content-Type":"application/json",Authorization:"Bearer "+o}}).then((t=>t.json())).then((i=>{let o=i._embedded[n][0].id;t.commit("createEntity",{name:e,id:o}),t.commit("saveEntity"),t.commit("endLoading")})).catch((t=>console.log(t)))},aInit(t){t.commit("init")},aClearEntities(t){t.commit("clearEntities")}}}));(0,i.ri)(x).use(z).mount("#app")}},e={};function n(i){var o=e[i];if(void 0!==o)return o.exports;var s=e[i]={exports:{}};return t[i](s,s.exports,n),s.exports}n.m=t,function(){var t=[];n.O=function(e,i,o,s){if(!i){var r=1/0;for(d=0;d<t.length;d++){i=t[d][0],o=t[d][1],s=t[d][2];for(var a=!0,l=0;l<i.length;l++)(!1&s||r>=s)&&Object.keys(n.O).every((function(t){return n.O[t](i[l])}))?i.splice(l--,1):(a=!1,s<r&&(r=s));if(a){t.splice(d--,1);var c=o();void 0!==c&&(e=c)}}return e}s=s||0;for(var d=t.length;d>0&&t[d-1][2]>s;d--)t[d]=t[d-1];t[d]=[i,o,s]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};n.O.j=function(e){return 0===t[e]};var e=function(e,i){var o,s,r=i[0],a=i[1],l=i[2],c=0;if(r.some((function(e){return 0!==t[e]}))){for(o in a)n.o(a,o)&&(n.m[o]=a[o]);if(l)var d=l(n)}for(e&&e(i);c<r.length;c++)s=r[c],n.o(t,s)&&t[s]&&t[s][0](),t[s]=0;return n.O(d)},i=self["webpackChunktestgen"]=self["webpackChunktestgen"]||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))}();var i=n.O(void 0,[998],(function(){return n(1930)}));i=n.O(i)})();
//# sourceMappingURL=app.2b9249b3.js.map